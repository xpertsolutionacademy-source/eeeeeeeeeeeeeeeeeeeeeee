<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoCall Pro - Professional Video Conferencing</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add Socket.io -->
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000000;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Landing Page Styles */
        .landing-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000000;
            position: relative;
            overflow: hidden;
        }

        .landing-section::before {
            content: '';
            position: absolute;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(34, 251, 9, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            top: -300px;
            right: -300px;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-20px) scale(1.1);
            }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.6);
        }

        .btn-primary {
            background: linear-gradient(135deg, #22FB09 0%, #1DA708 100%);
            color: #000000;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(34, 251, 9, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: rgba(34, 251, 9, 0.2);
            border-color: #22FB09;
        }

        /* Share Link Join Section */
        .share-link-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(34, 251, 9, 0.05);
            border: 1px solid rgba(34, 251, 9, 0.2);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .share-link-section:hover {
            background: rgba(34, 251, 9, 0.1);
            border-color: #22FB09;
        }

        .input-group {
            position: relative;
            margin-bottom: 1rem;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #22FB09;
        }

        .input-with-icon {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 12px 20px 12px 50px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-with-icon:focus {
            outline: none;
            border-color: #22FB09;
            background: rgba(255, 255, 255, 0.15);
        }

        .input-with-icon::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .join-link-btn {
            background: linear-gradient(135deg, #22FB09 0%, #1DA708 100%);
            color: #000000;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        .join-link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(34, 251, 9, 0.4);
        }

        /* Active Rooms Section */
        .active-rooms-section {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(34, 251, 9, 0.3);
        }

        .room-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(34, 251, 9, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-card:hover {
            background: rgba(34, 251, 9, 0.1);
            border-color: #22FB09;
            transform: translateX(5px);
        }

        .room-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .room-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(34, 251, 9, 0.2);
            color: #22FB09;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .room-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-join {
            background: #22FB09;
            color: #000000;
        }

        .btn-join:hover {
            background: #1DA708;
            transform: scale(1.05);
        }

        .btn-share {
            background: transparent;
            color: #22FB09;
            border: 1px solid #22FB09;
        }

        .btn-share:hover {
            background: rgba(34, 251, 9, 0.2);
        }

        /* Video Call Interface Styles */
        .video-call-container {
            display: none;
            height: 100vh;
            background: #000000;
            position: relative;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .video-wrapper {
            position: relative;
            background: #111111;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
            aspect-ratio: 16/9;
        }

        .video-wrapper.active {
            border-color: #22FB09;
        }

        .video-wrapper.connecting {
            border-color: #f59e0b;
        }

        .video-wrapper.pinned {
            border-color: #3b82f6;
            grid-column: span 2;
            grid-row: span 2;
        }

        .video-element {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #111111 0%, #1a1a1a 100%);
        }

        .connecting-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .connecting-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(34, 251, 9, 0.3);
            border-top: 3px solid #22FB09;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .video-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-wrapper:hover .video-controls {
            opacity: 1;
        }

        .video-control-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .video-control-btn:hover {
            background: rgba(34, 251, 9, 0.3);
            transform: scale(1.1);
        }

        .video-label {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(34, 251, 9, 0.3);
        }

        .controls-bar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            padding: 15px 30px;
            border-radius: 50px;
            display: flex;
            gap: 20px;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(34, 251, 9, 0.3);
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .control-btn:hover {
            background: rgba(34, 251, 9, 0.3);
            transform: scale(1.1);
        }

        .control-btn.active {
            background: #22FB09;
            color: #000000;
        }

        .control-btn.share-btn {
            background: rgba(34, 251, 9, 0.2);
            border: 2px solid #22FB09;
            color: #22FB09;
        }

        .control-btn.share-btn:hover {
            background: rgba(34, 251, 9, 0.4);
        }

        .control-btn.end-call {
            background: #ef4444;
        }

        .control-btn.end-call:hover {
            background: #dc2626;
        }

        .room-info {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #22FB09;
        }

        .api-status {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #22FB09;
        }

        .api-status.connected {
            border-color: #22FB09;
        }

        .api-status.disconnected {
            border-color: #ef4444;
        }

        .participants-list {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            min-width: 250px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #22FB09;
        }

        .participant-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s ease;
            margin-bottom: 5px;
        }

        .participant-item:hover {
            background: rgba(34, 251, 9, 0.1);
        }

        .participant-item:hover .participant-actions {
            opacity: 1;
        }

        .participant-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .participant-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22FB09 0%, #1DA708 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #000000;
            position: relative;
        }

        .participant-avatar.host::after {
            content: 'ðŸ‘‘';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
        }

        .participant-details {
            flex: 1;
        }

        .participant-name {
            font-size: 14px;
            font-weight: 500;
        }

        .participant-status {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .participant-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #22FB09;
        }

        .participant-indicator.connecting {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        .participant-indicator.muted {
            background: #ef4444;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .participant-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .participant-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .participant-action-btn:hover {
            background: rgba(34, 251, 9, 0.3);
            transform: scale(1.1);
        }

        .participant-action-btn.mute {
            color: #ef4444;
        }

        .participant-action-btn.pin {
            color: #3b82f6;
        }

        .participant-action-btn.remove {
            color: #ef4444;
        }

        .chat-panel {
            position: absolute;
            right: -350px;
            top: 0;
            width: 350px;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #22FB09;
        }

        .chat-panel.open {
            right: 0;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #22FB09;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #22FB09;
        }

        .chat-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #22FB09;
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            outline: none;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            background: rgba(34, 251, 9, 0.1);
            border-radius: 15px;
            animation: slideIn 0.3s ease;
            border-left: 3px solid #22FB09;
        }

        .message.own {
            background: rgba(34, 251, 9, 0.2);
            border-left: 3px solid #22FB09;
            margin-left: 20px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .message-author {
            font-size: 12px;
            color: #22FB09;
            margin-bottom: 5px;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            border: 1px solid #22FB09;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #22FB09;
        }

        .notification.error {
            border-left: 4px solid #ef4444;
        }

        .notification.info {
            border-left: 4px solid #3b82f6;
        }

        .share-link-container {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 15px;
            display: none;
            align-items: center;
            gap: 15px;
            border: 1px solid #22FB09;
        }

        .share-link-container.show {
            display: flex;
        }

        .share-link-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #22FB09;
            border-radius: 8px;
            padding: 8px 15px;
            color: white;
            font-size: 14px;
            min-width: 300px;
        }

        .copy-btn {
            background: #22FB09;
            color: #000000;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #1DA708;
        }

        .capacity-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .capacity-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: #22FB09;
            transition: width 0.3s ease;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(34, 251, 9, 0.3), transparent);
            margin: 2rem 0;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #22FB09;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 10px 15px;
            background: rgba(34, 251, 9, 0.05);
            border-radius: 15px;
            margin-bottom: 10px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #22FB09;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }

        .waiting-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
        }

        .waiting-message i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #22FB09;
        }

        .chat-toggle {
            position: absolute;
            bottom: 100px;
            right: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #22FB09;
            border-radius: 50px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .chat-toggle:hover {
            background: rgba(34, 251, 9, 0.2);
            transform: scale(1.05);
        }

        .chat-toggle.active {
            background: rgba(34, 251, 9, 0.3);
        }

        .invite-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .invite-modal.show {
            display: flex;
        }

        .invite-content {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid #22FB09;
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
        }

        .invite-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .invite-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .invite-option:hover {
            background: rgba(34, 251, 9, 0.1);
            border-color: #22FB09;
        }

        .invite-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(34, 251, 9, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #22FB09;
        }

        @media (max-width: 768px) {
            .video-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }

            .controls-bar {
                bottom: 20px;
                padding: 10px 20px;
                gap: 15px;
            }

            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .participants-list {
                display: none;
            }

            .chat-panel {
                width: 100%;
            }

            .share-link-container {
                width: 90%;
                flex-direction: column;
            }

            .share-link-input {
                min-width: 100%;
            }

            .room-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .room-actions {
                width: 100%;
                justify-content: space-between;
            }

            .chat-toggle {
                bottom: 80px;
                right: 20px;
                padding: 8px 15px;
            }

            .video-wrapper.pinned {
                grid-column: span 1;
                grid-row: span 1;
            }

            /* ===================================================== */
/* MULTI PARTICIPANT VIDEO WALLPAPER & RESPONSIVE LOGIC */
/* ===================================================== */

/* ===================== */
/* COMMON (3+ USERS) */
/* ===================== */
.video-call-container.multi-participant {
    background: radial-gradient(
        circle at center,
        rgba(34, 251, 9, 0.12),
        #000000 70%
    );
}

/* soften empty areas */
.video-call-container.multi-participant::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
        circle at center,
        rgba(34, 251, 9, 0.08),
        transparent 65%
    );
    pointer-events: none;
    z-index: 0;
}

/* keep videos above wallpaper */
.video-call-container.multi-participant .video-grid,
.video-call-container.multi-participant .controls-bar,
.video-call-container.multi-participant .participants-list,
.video-call-container.multi-participant .chat-toggle {
    position: relative;
    z-index: 2;
}

/* ===================== */
/* DESKTOP (3+ USERS) */
/* ===================== */
@media (min-width: 769px) {
    .video-call-container.multi-participant .video-grid {
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        align-items: center;
        justify-content: center;
    }

    .video-call-container.multi-participant .video-wrapper {
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
    }

    /* pinned video stays dominant */
    .video-call-container.multi-participant .video-wrapper.pinned {
        grid-column: span 2;
        grid-row: span 2;
    }
}

/* ===================== */
/* MOBILE (3+ USERS) */
/* ===================== */
@media (max-width: 768px) {
    .video-call-container.multi-participant {
        background: linear-gradient(
            180deg,
            #000000,
            rgba(34, 251, 9, 0.15)
        );
    }

    .video-call-container.multi-participant .video-grid {
        grid-template-columns: 1fr;
        grid-auto-rows: minmax(200px, auto);
        padding-bottom: 140px;
    }

    .video-call-container.multi-participant .video-wrapper {
        background: linear-gradient(
            135deg,
            #000000,
            #111111
        );
        border: 1px solid rgba(34, 251, 9, 0.35);
    }

    /* mobile pinned should NOT break layout */
    .video-call-container.multi-participant .video-wrapper.pinned {
        grid-column: span 1;
        grid-row: span 1;
    }
}

/* ===================== */
/* VIDEO OFF / LOADING WALLPAPER */
/* ===================== */
.video-call-container.multi-participant .video-placeholder {
    background: radial-gradient(
        circle at center,
        rgba(34, 251, 9, 0.18),
        transparent 70%
    );
}

/* ===================== */
/* SMOOTHER SCROLL (MANY USERS) */
/* ===================== */
.video-call-container.multi-participant .video-grid {
    scrollbar-width: thin;
    scrollbar-color: #22FB09 transparent;
}

.video-call-container.multi-participant .video-grid::-webkit-scrollbar {
    width: 6px;
}

.video-call-container.multi-participant .video-grid::-webkit-scrollbar-thumb {
    background: rgba(34, 251, 9, 0.6);
    border-radius: 10px;
}

        }
    </style>
</head>

<body>
    <!-- Landing Page (NO CHANGES) -->
    <section id="landingPage" class="landing-section">
        <div class="container mx-auto px-4">
            <div class="max-w-2xl mx-auto text-center mb-12">
                <h1 class="text-5xl md:text-6xl font-bold mb-6" style="color: #22FB09;">
                    VideoCall Pro
                </h1>
                <p class="text-xl text-gray-300 mb-8">
                    Professional video conferencing with WebRTC API integration
                </p>
            </div>

            <div class="max-w-md mx-auto glass-card">
                <h2 class="text-2xl font-semibold mb-6">Create or Join a Room</h2>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-300">Your Name</label>
                    <div class="input-group">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="userName" class="input-with-icon" placeholder="Enter your name">
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2 text-gray-300">Room ID</label>
                    <div class="input-group">
                        <i class="fas fa-door-open input-icon"></i>
                        <input type="text" id="roomId" class="input-with-icon"
                            placeholder="Enter room ID or leave blank to create">
                    </div>
                </div>

                <div class="flex flex-col gap-3">
                    <button onclick="createRoom()" class="btn-primary justify-center">
                        <i class="fas fa-plus"></i>
                        Create New Room
                    </button>
                    <button onclick="joinRoom()" class="btn-secondary">
                        <i class="fas fa-sign-in-alt"></i>
                        Join Room
                    </button>
                </div>

                <div class="divider"></div>

                <!-- Share Link Join Section -->
                <div class="share-link-section">
                    <h3 class="section-title">
                        <i class="fas fa-link"></i>
                        Join via Share Link
                    </h3>
                    <div class="mb-4">
                        <div class="input-group">
                            <i class="fas fa-share-alt input-icon"></i>
                            <input type="text" id="shareLinkJoin" class="input-with-icon"
                                placeholder="Paste share link here">
                        </div>
                    </div>
                    <button onclick="joinViaShareLink()" class="join-link-btn">
                        <i class="fas fa-rocket"></i>
                        Join via Share Link
                    </button>
                </div>

                <div class="mt-6 pt-6 border-t border-white/10">
                    <p class="text-sm text-gray-400">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Your calls are secure and encrypted
                    </p>
                </div>

                <!-- Active Rooms Section -->
                <div class="active-rooms-section">
                    <h3 class="section-title">
                        <i class="fas fa-fire"></i>
                        Live Rooms
                    </h3>
                    <div id="activeRoomsList">
                        <!-- Active rooms will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Video Call Interface (NO STRUCTURAL CHANGES) -->
    <div id="videoCallContainer" class="video-call-container">
        <!-- API Status -->
        <div class="api-status connected" id="apiStatus">
            <i class="fas fa-check-circle" style="color: #22FB09;"></i>
            <span>Connecting to server...</span>
        </div>

        <!-- Room Info -->
        <div class="room-info">
            <i class="fas fa-users"></i>
            <span>Room: <span id="currentRoomId">ROOM-1234</span></span>
            <span id="participantCount">1 participant</span>
            <span class="room-status">
                <i class="fas fa-circle" style="color: #22FB09;"></i>
                LIVE
            </span>
        </div>

        <!-- Share Link Container -->
        <div id="shareLinkContainer" class="share-link-container">
            <input type="text" id="shareLinkInput" class="share-link-input" readonly>
            <button onclick="copyShareLink()" class="copy-btn">
                <i class="fas fa-copy mr-2"></i>Copy Link
            </button>
        </div>

        <!-- Participants List -->
        <div class="participants-list">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 class="font-semibold">Participants</h3>
                <button onclick="showInviteModal()" class="btn-small" style="background: #22FB09; color: #000000;">
                    <i class="fas fa-user-plus mr-1"></i>Invite
                </button>
            </div>
            <div id="participantsList">
                <!-- Participants will be added here -->
            </div>
        </div>

        <!-- Video Grid -->
        <div class="video-grid" id="videoGrid">
            <!-- Local Video -->
            <div class="video-wrapper active" id="localVideoWrapper">
                <video id="localVideo" class="video-element" autoplay muted playsinline></video>
                <div class="video-placeholder" id="localVideoPlaceholder">
                    <div class="text-center">
                        <i class="fas fa-user-circle text-6xl mb-4 text-gray-500"></i>
                        <p class="text-gray-400">Waiting for camera...</p>
                    </div>
                </div>
                <div class="video-controls">
                    <button class="video-control-btn" onclick="pinVideo('localVideoWrapper')" title="Pin">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    <button class="video-control-btn" onclick="toggleFullscreen('localVideoWrapper')"
                        title="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="video-label">You</div>
            </div>

            <!-- Waiting for participants message -->
            <div class="waiting-message" id="waitingMessage">
                <i class="fas fa-user-plus"></i>
                <h3 class="text-xl font-semibold mb-2">Waiting for participants</h3>
                <p class="text-sm">Share your room link to invite others</p>
            </div>
        </div>

        <!-- Controls Bar -->
        <div class="controls-bar">
            <button class="control-btn" id="micBtn" onclick="toggleMic()" title="Toggle Microphone">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="control-btn" id="videoBtn" onclick="toggleVideo()" title="Toggle Video">
                <i class="fas fa-video"></i>
            </button>
            <button class="control-btn" onclick="toggleScreenShare()" title="Share Screen">
                <i class="fas fa-desktop"></i>
            </button>
            <button class="control-btn share-btn" onclick="toggleShareLink()" title="Share Link">
                <i class="fas fa-share-alt"></i>
            </button>
            <button class="control-btn" onclick="toggleChat()" title="Chat">
                <i class="fas fa-comment"></i>
            </button>
            <button class="control-btn" onclick="toggleParticipants()" title="Participants">
                <i class="fas fa-users"></i>
            </button>
            <button class="control-btn end-call" onclick="endCall()" title="End Call">
                <i class="fas fa-phone-slash"></i>
            </button>
        </div>

        <!-- Chat Toggle Button -->
        <div class="chat-toggle" id="chatToggle" onclick="toggleChat()">
            <i class="fas fa-comment"></i>
            <span>Chat</span>
        </div>

        <!-- Chat Panel -->
        <div id="chatPanel" class="chat-panel">
            <div class="chat-header">
                <h3 class="font-semibold">Chat</h3>
                <button onclick="toggleChat()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message">
                    <div class="message-author">System</div>
                    <div>Welcome to the video call! You can start chatting now.</div>
                    <div class="message-time">Just now</div>
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <span class="text-sm text-gray-400">Someone is typing</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="Type a message..."
                    onkeypress="handleChatInput(event)" oninput="handleChatInput(event)">
            </div>
        </div>
    </div>

    <!-- Invite Modal -->
    <div id="inviteModal" class="invite-modal">
        <div class="invite-content">
            <h2 class="text-2xl font-semibold mb-4" style="color: #22FB09;">Invite Participants</h2>
            <p class="text-gray-400 mb-6">Choose how you want to invite others to this room</p>

            <div class="invite-options">
                <div class="invite-option" onclick="copyShareLink()">
                    <div class="invite-icon">
                        <i class="fas fa-link"></i>
                    </div>
                    <div>
                        <div class="font-semibold">Copy Link</div>
                        <div class="text-sm text-gray-400">Share the room link with others</div>
                    </div>
                </div>

                <div class="invite-option" onclick="sendEmailInvite()">
                    <div class="invite-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div>
                        <div class="font-semibold">Email Invite</div>
                        <div class="text-sm text-gray-400">Send invitation via email</div>
                    </div>
                </div>

                <div class="invite-option" onclick="generateQRCode()">
                    <div class="invite-icon">
                        <i class="fas fa-qrcode"></i>
                    </div>
                    <div>
                        <div class="font-semibold">QR Code</div>
                        <div class="text-sm text-gray-400">Generate QR code for mobile</div>
                    </div>
                </div>
            </div>

            <button onclick="hideInviteModal()" class="btn-secondary w-full mt-4">
                Close
            </button>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-info-circle text-2xl"></i>
        <div>
            <div class="font-semibold" id="notificationTitle">Notification</div>
            <div class="text-sm text-gray-300" id="notificationMessage">Message</div>
        </div>
    </div>

    <script>
        // Global variables
        let localStream = null;
        let peerConnections = {};
        let pendingCandidates ={}
        let currentRoom = null;
        let userName = '';
        let userId = null;
        let isMicOn = true;
        let isVideoOn = true;
        let isScreenSharing = false;
        let isShareLinkVisible = false;
        let isChatOpen = false;
        let activeRooms = [];
        let participants = [];
        let chatMessages = [];
        let typingTimeout = null;
        let socket = null;
        let isHost = false;
        let pinnedVideo = null;

        // WebRTC Configuration
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' },
                { urls: 'stun:stun2.l.google.com:19302' }
            ]
        };

        // Signaling server URL - CHANGE THIS TO YOUR SERVER URL
        const SIGNALING_SERVER = 'https://callserver-35kh.onrender.com';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            // Check for WebRTC support
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('error', 'Browser Not Supported', 'Your browser does not support WebRTC');
                return;
            }

            // Initialize active rooms with sample data
            initializeActiveRooms();

            // Check for room ID in URL
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');

            if (roomId) {
                document.getElementById('roomId').value = roomId;
            }
        });

        // Initialize active rooms with sample data
        function initializeActiveRooms() {
            activeRooms = [
                { id: 'ROOM-MATH101', name: 'Mathematics 101', participants: 45, maxParticipants: 100, host: 'Dr. Smith' },
                { id: 'ROOM-PHYS202', name: 'Physics Lab', participants: 78, maxParticipants: 100, host: 'Prof. Johnson' },
                { id: 'ROOM-CHEM301', name: 'Chemistry Lecture', participants: 92, maxParticipants: 100, host: 'Dr. Williams' },
                { id: 'ROOM-BIO401', name: 'Biology Seminar', participants: 23, maxParticipants: 100, host: 'Prof. Brown' },
                { id: 'ROOM-ENG501', name: 'English Literature', participants: 67, maxParticipants: 100, host: 'Dr. Davis' }
            ];

            renderActiveRooms();
        }

        // Render active rooms
        function renderActiveRooms() {
            const container = document.getElementById('activeRoomsList');
            container.innerHTML = '';

            activeRooms.forEach(room => {
                const capacityPercentage = (room.participants / room.maxParticipants) * 100;
                const roomCard = document.createElement('div');
                roomCard.className = 'room-card';
                roomCard.innerHTML = `
                    <div class="room-info">
                        <div>
                            <div class="font-semibold">${room.id}</div>
                            <div class="text-sm text-gray-400">${room.name} â€¢ Host: ${room.host}</div>
                            <div class="capacity-indicator">
                                <i class="fas fa-users text-xs"></i>
                                <span class="text-xs">${room.participants}/${room.maxParticipants}</span>
                                <div class="capacity-bar">
                                    <div class="capacity-fill" style="width: ${capacityPercentage}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="room-actions">
                        <button onclick="joinActiveRoom('${room.id}')" class="btn-small btn-join">
                            <i class="fas fa-sign-in-alt mr-1"></i>Join
                        </button>
                        <button onclick="shareRoomLink('${room.id}')" class="btn-small btn-share">
                            <i class="fas fa-share-alt mr-1"></i>Share
                        </button>
                    </div>
                `;
                container.appendChild(roomCard);
            });
        }

        // Create a new room
        function createRoom() {
            const name = document.getElementById('userName').value.trim();
            if (!name) {
                showNotification('error', 'Name Required', 'Please enter your name');
                return;
            }

            userName = name;
            currentRoom = generateRoomId();
            isHost = true;

            // Add to active rooms (for demo)
            const newRoom = {
                id: currentRoom,
                name: `${userName}'s Room`,
                participants: 1,
                maxParticipants: 100,
                host: userName
            };
            activeRooms.unshift(newRoom);
            renderActiveRooms();

            showNotification('success', 'Room Created', `Room ID: ${currentRoom}`);

            setTimeout(() => {
                startVideoCall();
            }, 1000);
        }

        // Join an existing room
        function joinRoom() {
            const name = document.getElementById('userName').value.trim();
            const roomId = document.getElementById('roomId').value.trim();

            if (!name) {
                showNotification('error', 'Name Required', 'Please enter your name');
                return;
            }

            if (!roomId) {
                showNotification('error', 'Room ID Required', 'Please enter a room ID');
                return;
            }

            userName = name;
            currentRoom = roomId;
            isHost = false;

            showNotification('success', 'Joining Room', `Connecting to room: ${roomId}`);

            setTimeout(() => {
                startVideoCall();
            }, 1000);
        }

        // Join via share link
        function joinViaShareLink() {
            const name = document.getElementById('userName').value.trim();
            const shareLink = document.getElementById('shareLinkJoin').value.trim();

            if (!name) {
                showNotification('error', 'Name Required', 'Please enter your name');
                return;
            }

            if (!shareLink) {
                showNotification('error', 'Share Link Required', 'Please paste a share link');
                return;
            }

            try {
                // Parse the URL to extract room ID
                let url;
                if (shareLink.startsWith('http://') || shareLink.startsWith('https://')) {
                    url = new URL(shareLink);
                } else {
                    url = new URL(shareLink, window.location.origin);
                }

                const roomId = url.searchParams.get('room');

                if (roomId) {
                    document.getElementById('roomId').value = roomId;
                    document.getElementById('shareLinkJoin').value = '';
                    joinRoom();
                } else {
                    showNotification('error', 'Invalid Link', 'The share link does not contain a valid room ID');
                }
            } catch (error) {
                showNotification('error', 'Invalid Link', 'Please enter a valid share link');
            }
        }

        // Join active room from list
        function joinActiveRoom(roomId) {
            document.getElementById('roomId').value = roomId;
            joinRoom();
        }

        // Share room link
        function shareRoomLink(roomId) {
            const shareLink = `${window.location.origin}${window.location.pathname}?room=${roomId}`;

            if (navigator.share) {
                navigator.share({
                    title: 'Join my video call',
                    text: `Join room ${roomId} on VideoCall Pro`,
                    url: shareLink
                });
            } else {
                navigator.clipboard.writeText(shareLink).then(() => {
                    showNotification('success', 'Link Copied', 'Room link copied to clipboard');
                });
            }
        }

        // Generate a random room ID
        function generateRoomId() {
            return 'ROOM-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        // Start the video call
        async function startVideoCall() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('videoCallContainer').style.display = 'block';
            document.getElementById('currentRoomId').textContent = currentRoom;

            // Generate user ID
            userId = 'user-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

            // Set the share link
            const shareLink = `${window.location.origin}${window.location.pathname}?room=${currentRoom}`;
            document.getElementById('shareLinkInput').value = shareLink;

            try {
                // Connect to signaling server
                await connectToSignalingServer();

                // Get local media stream
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });

                // Display local video
                const localVideo = document.getElementById('localVideo');
                localVideo.srcObject = localStream;

                // Hide placeholder
                document.getElementById('localVideoPlaceholder').style.display = 'none';

                // Add self to participants list
                addParticipantToList(userName, true, true);

                // Update participant count
                updateParticipantCount();

                // Show waiting message
                const waitingMessage = document.getElementById('waitingMessage');
                if (participants <= 1) {
                 waitingMessage.style.display = 'block';
                } else {
                  waitingMessage.style.display = 'none';
            }

                showNotification('success', 'Connected', 'You are now in the video call');

            } catch (error) {
                console.error('Error starting video call:', error);
                showNotification('error', 'Connection Error', 'Unable to start video call');
            }
        }

        function attachRemoteVideo(remoteUserId, remoteUserName, stream) {
    let videoElement = document.getElementById(`remoteVideo-${remoteUserId}`);

    if (!videoElement) {
        const videoGrid = document.getElementById('videoGrid');

        const wrapper = document.createElement('div');
        wrapper.className = 'video-wrapper active';
        wrapper.id = `videoWrapper-${remoteUserId}`;

        wrapper.innerHTML = `
            <video 
                id="remoteVideo-${remoteUserId}" 
                class="video-element" 
                autoplay 
                playsinline>
            </video>
            <div class="video-label">
                ${remoteUserName || 'Participant'}
            </div>
        `;

        videoGrid.appendChild(wrapper);
        videoElement = wrapper.querySelector('video');
    }

    // Attach stream (idempotent)
    if (videoElement.srcObject !== stream) {
        videoElement.srcObject = stream;
    }
}


        async function initMedia() {
    localStream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
    });

    document.getElementById('localVideo').srcObject = localStream;
}
// Connect to signaling server
async function connectToSignalingServer() {
    socket = io(SIGNALING_SERVER);

    socket.on('connect', () => {
        console.log('Connected:', socket.id);
        socket.emit('join-room', currentRoom, socket.id, userName);
    });

    socket.on('existing-users', users => {
        console.log('Existing users:', users);
        if (users.length > 0) {
                            document.getElementById('waitingMessage').style.display = 'none';
                        }

                        users.forEach(user => {
                            createPeerConnection(user.id, user.name);
                            addParticipantToList(user.name || 'Guest', false, false);
                        });

                        updateParticipantCount();
    });


    socket.on('chat-message', ( message, senderName) => {
       if(senderName !== userName){ 
        addChatMessage(senderName,  message);}
    });
    socket.on('user-connected', async (userId, name) => {
        console.log('User connected:', userId);
        await createPeerConnection(userId, name, true); // ðŸ‘ˆ caller
    });

    socket.on('signal', handleSignalingData);

    socket.on('user-disconnected', userId => {
        cleanupPeer(userId);
    });
}

async function waitForLocalStream(){
    return new Promise((resolve) => {
        const checkStream = setInterval(() => {
            if(localStream){
                clearInterval(checkStream);
                resolve();
            }
        }, 100);
    });
}

        // Create WebRTC peer connection
        async function createPeerConnection(remoteUserId, remoteUserName, isCaller = false) {

            if(!localStream){
                console.log("no local stream")
                await waitForLocalStream();
            }
    if (peerConnections[remoteUserId]) return peerConnections[remoteUserId];

    const pc = new RTCPeerConnection(configuration);
    peerConnections[remoteUserId] = pc;

    // Add local tracks FIRST
    localStream.getTracks().forEach(track => {
        pc.addTrack(track, localStream);
    });

    // ICE candidates
    pc.onicecandidate = event => {
        if (event.candidate) {
            socket.emit('signal', {
                type: 'candidate',
                to: remoteUserId,
                from: socket.id,
                candidate: event.candidate
            });
        }
    };

    // Remote stream
    const remoteStream = new MediaStream();

    pc.ontrack = event => {
        event.streams[0].getTracks().forEach(track => {
            remoteStream.addTrack(track);
        });

        attachRemoteVideo(remoteUserId, remoteUserName, remoteStream);
    };

    // Connection state
    pc.onconnectionstatechange = () => {
        console.log(remoteUserId, pc.connectionState);
        if (pc.connectionState === 'failed') cleanupPeer(remoteUserId);
    };

    // ðŸ‘‰ ONLY CALLER CREATES OFFER
    if (isCaller) {
        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        socket.emit('signal', {
            type: 'offer',
            to: remoteUserId,
            from: socket.id,
            offer: pc.localDescription
        });
    }

    return pc;
}

        function cleanupPeer(userId) {
    const pc = peerConnections[userId];
    if (pc) {
        pc.close();
        delete peerConnections[userId];
    }

    const video = document.getElementById(`remoteVideo-${userId}`);
    if (video) video.remove();
}


        // Handle incoming signaling data
        async function handleSignalingData(data) {
    const { type, from } = data;
    let pc = peerConnections[from];

    if (!pc) {
        pc = await createPeerConnection(from, 'Guest', false);
    }

    if (type === 'offer') {
        await pc.setRemoteDescription(new RTCSessionDescription(data.offer));

        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);

        socket.emit('signal', {
            type: 'answer',
            to: from,
            from: socket.id,
            answer: pc.localDescription
        });

        // ðŸ”¥ Apply queued ICE
        if (pendingCandidates[from]) {
            for (const c of pendingCandidates[from]) {
                await pc.addIceCandidate(new RTCIceCandidate(c));
            }
            delete pendingCandidates[from];
        }

    } 
    else if (type === 'answer') {
        await pc.setRemoteDescription(new RTCSessionDescription(data.answer));

        // ðŸ”¥ Apply queued ICE
        if (pendingCandidates[from]) {
            for (const c of pendingCandidates[from]) {
                await pc.addIceCandidate(new RTCIceCandidate(c));
            }
            delete pendingCandidates[from];
        }

    } 
    else if (type === 'candidate') {
        if (pc.remoteDescription) {
            await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
        } else {
            pendingCandidates[from] = pendingCandidates[from] || [];
            pendingCandidates[from].push(data.candidate);
        }
    }
}

        // Add participant to list
        function addParticipantToList(name, isSelf = false, isHostUser = false) {
            const participantsList = document.getElementById('participantsList');

            // Check if already added
            const existing = document.getElementById(`participant-${name.replace(/\s+/g, '-')}`);
            if (existing) return;

            const participantItem = document.createElement('div');
            participantItem.className = 'participant-item';
            participantItem.id = `participant-${name.replace(/\s+/g, '-')}`;

            participantItem.innerHTML = `
                <div class="participant-info">
                    <div class="participant-avatar ${isHostUser ? 'host' : ''}">${name.charAt(0)}</div>
                    <div class="participant-details">
                        <div class="participant-name">${name} ${isSelf ? '(You)' : ''}</div>
                        <div class="participant-status">
                            <div class="participant-indicator"></div>
                            <span>${isHostUser ? 'Host' : 'Participant'}</span>
                        </div>
                    </div>
                </div>
                <div class="participant-actions">
                    ${isSelf ? `
                    <button class="participant-action-btn" title="Mute" onclick="toggleMic()">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="participant-action-btn" title="Video" onclick="toggleVideo()">
                        <i class="fas fa-video"></i>
                    </button>
                    ` : `
                    <button class="participant-action-btn mute" title="Mute" onclick="muteParticipant('${name}')">
                        <i class="fas fa-microphone-slash"></i>
                    </button>
                    <button class="participant-action-btn pin" title="Pin" onclick="pinParticipant('${name}')">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    ${isHost ? `<button class="participant-action-btn remove" title="Remove" onclick="removeParticipant('${name}')">
                        <i class="fas fa-times"></i>
                    </button>` : ''}
                    `}
                </div>
            `;

            participantsList.appendChild(participantItem);
        }

        // Remove remote participant
        function removeRemoteParticipant(userId) {
            // Remove video element
            const videoWrapper = document.getElementById(`videoWrapper-${userId}`);
            if (videoWrapper) {
                videoWrapper.remove();
            }

            // Remove from participants list
            // Note: We need to track userId to name mapping
            // For simplicity, we'll just update count

            // Close peer connection
            if (peerConnections[userId]) {
                peerConnections[userId].close();
                delete peerConnections[userId];
            }

            // Show waiting message if no remote participants
            const videoWrappers = document.querySelectorAll('.video-wrapper:not(#localVideoWrapper)');
            if (videoWrappers.length === 0) {
                document.getElementById('waitingMessage').style.display = 'block';
            }
        }

        // Update participant count
        function updateParticipantCount() {
            const participantItems = document.querySelectorAll('.participant-item');
            const count = participantItems.length;
            document.getElementById('participantCount').textContent = `${count} participant${count !== 1 ? 's' : ''}`;
        }

        // Mute participant (placeholder - needs WebRTC implementation)
        function muteParticipant(name) {
            showNotification('info', 'Feature', 'Mute participant feature requires additional WebRTC implementation');
        }

        // Pin participant
        function pinParticipant(name) {
            const participantId = name.replace(/\s+/g, '-');
            const videoWrappers = document.querySelectorAll('.video-wrapper');

            videoWrappers.forEach(wrapper => {
                if (wrapper.id.includes(participantId)) {
                    pinVideo(wrapper.id);
                }
            });
        }

        // Remove participant
        function removeParticipant(name) {
            if (confirm(`Are you sure you want to remove ${name} from the call?`)) {
                showNotification('info', 'Feature', 'Remove participant feature requires host controls implementation');
            }
        }

        // Pin video
        function pinVideo(videoId) {
            const videoWrapper = document.getElementById(videoId);
            if (videoWrapper) {
                if (pinnedVideo === videoId) {
                    videoWrapper.classList.remove('pinned');
                    pinnedVideo = null;
                } else {
                    if (pinnedVideo) {
                        document.getElementById(pinnedVideo).classList.remove('pinned');
                    }
                    videoWrapper.classList.add('pinned');
                    pinnedVideo = videoId;
                }
            }
        }

        // Toggle fullscreen
        function toggleFullscreen(videoId) {
            const videoWrapper = document.getElementById(videoId);
            if (videoWrapper) {
                if (!document.fullscreenElement) {
                    videoWrapper.requestFullscreen().catch(err => {
                        console.error('Error enabling fullscreen:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            }
        }

        // Toggle microphone
        function toggleMic() {
            const micBtn = document.getElementById('micBtn');
            const icon = micBtn.querySelector('i');

            if (localStream) {
                const audioTrack = localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = !audioTrack.enabled;
                    isMicOn = audioTrack.enabled;

                    if (isMicOn) {
                        icon.className = 'fas fa-microphone';
                        micBtn.classList.remove('active');
                    } else {
                        icon.className = 'fas fa-microphone-slash';
                        micBtn.classList.add('active');
                    }

                    showNotification('info', 'Microphone', `Microphone ${isMicOn ? 'enabled' : 'disabled'}`);
                }
            }
        }

        // Toggle video
        function toggleVideo() {
            const videoBtn = document.getElementById('videoBtn');
            const icon = videoBtn.querySelector('i');
            const placeholder = document.getElementById('localVideoPlaceholder');
            const localVideo = document.getElementById('localVideo');

            if (localStream) {
                const videoTrack = localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = !videoTrack.enabled;
                    isVideoOn = videoTrack.enabled;

                    if (isVideoOn) {
                        icon.className = 'fas fa-video';
                        videoBtn.classList.remove('active');
                        placeholder.style.display = 'none';
                        localVideo.style.display = 'block';
                    } else {
                        icon.className = 'fas fa-video-slash';
                        videoBtn.classList.add('active');
                        placeholder.style.display = 'flex';
                        localVideo.style.display = 'none';
                    }

                    // Update all peer connections
                    Object.values(peerConnections).forEach(pc => {
                        const sender = pc.getSenders().find(s => s.track.kind === 'video');
                        if (sender) {
                            sender.replaceTrack(videoTrack);
                        }
                    });

                    showNotification('info', 'Camera', `Camera ${isVideoOn ? 'enabled' : 'disabled'}`);
                }
            }
        }

        // Toggle screen sharing
        async function toggleScreenShare() {
            if (!isScreenSharing) {
                try {
                    const screenStream = await navigator.mediaDevices.getDisplayMedia({
                        video: true,
                        audio: false
                    });

                    // Replace video track in all peer connections
                    const videoTrack = screenStream.getVideoTracks()[0];
                    Object.values(peerConnections).forEach(pc => {
                        const sender = pc.getSenders().find(s => s.track.kind === 'video');
                        if (sender) {
                            sender.replaceTrack(videoTrack);
                        }
                    });

                    // Update local video
                    const localVideo = document.getElementById('localVideo');
                    localVideo.srcObject = screenStream;

                    isScreenSharing = true;
                    showNotification('info', 'Screen Sharing', 'You are now sharing your screen');

                    // Stop screen sharing when track ends
                    videoTrack.onended = () => {
                        toggleScreenShare();
                    };

                } catch (error) {
                    console.error('Error sharing screen:', error);
                    showNotification('error', 'Screen Share Error', 'Unable to share screen');
                }
            } else {
                // Switch back to camera
                try {
                    const cameraStream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: true
                    });

                    // Replace video track in all peer connections
                    const videoTrack = cameraStream.getVideoTracks()[0];
                    Object.values(peerConnections).forEach(pc => {
                        const sender = pc.getSenders().find(s => s.track.kind === 'video');
                        if (sender) {
                            sender.replaceTrack(videoTrack);
                        }
                    });

                    const localVideo = document.getElementById('localVideo');
                    localVideo.srcObject = cameraStream;

                    isScreenSharing = false;
                    showNotification('info', 'Screen Sharing Stopped', 'You are no longer sharing your screen');

                } catch (error) {
                    console.error('Error switching back to camera:', error);
                }
            }
        }

        // Toggle share link
        function toggleShareLink() {
            const shareLinkContainer = document.getElementById('shareLinkContainer');
            isShareLinkVisible = !isShareLinkVisible;

            if (isShareLinkVisible) {
                shareLinkContainer.classList.add('show');
            } else {
                shareLinkContainer.classList.remove('show');
            }
        }

        // Copy share link
        function copyShareLink() {
            const shareLinkInput = document.getElementById('shareLinkInput');
            shareLinkInput.select();
            shareLinkInput.setSelectionRange(0, 99999);

            try {
                document.execCommand('copy');
                showNotification('success', 'Link Copied', 'Share link copied to clipboard');
            } catch (err) {
                showNotification('error', 'Copy Failed', 'Unable to copy link');
            }
        }

        // Toggle chat panel
        function toggleChat() {
            const chatPanel = document.getElementById('chatPanel');
            const chatToggle = document.getElementById('chatToggle');

            isChatOpen = !isChatOpen;

            if (isChatOpen) {
                chatPanel.classList.add('open');
                chatToggle.classList.add('active');
            } else {
                chatPanel.classList.remove('open');
                chatToggle.classList.remove('active');
            }
        }

        // Toggle participants list
        function toggleParticipants() {
            const participantsList = document.querySelector('.participants-list');
            participantsList.style.display = participantsList.style.display === 'none' ? 'block' : 'none';
        }

        // Show invite modal
        function showInviteModal() {
            document.getElementById('inviteModal').classList.add('show');
        }

        // Hide invite modal
        function hideInviteModal() {
            document.getElementById('inviteModal').classList.remove('show');
        }

        // Send email invite
        function sendEmailInvite() {
            const shareLink = document.getElementById('shareLinkInput').value;
            const subject = `Join my video call - ${currentRoom}`;
            const body = `Hi,\n\nPlease join my video call using this link:\n${shareLink}\n\nLooking forward to seeing you!\n\nBest regards,\n${userName}`;

            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            hideInviteModal();
        }

        // Generate QR code
        function generateQRCode() {
            showNotification('info', 'QR Code', 'QR code generation feature coming soon!');
            hideInviteModal();
        }

        // End call
        function endCall() {
            if (confirm('Are you sure you want to end the call?')) {
                // Close all peer connections
                Object.values(peerConnections).forEach(pc => {
                    pc.close();
                });
                peerConnections = {};

                // Stop all tracks
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                }

                // Close socket connection
                if (socket) {
                    socket.disconnect();
                    socket = null;
                }

                // Update participant count in active rooms
                const room = activeRooms.find(r => r.id === currentRoom);
                if (room && room.participants > 0) {
                    room.participants--;
                    renderActiveRooms();
                }

                // Reset UI
                document.getElementById('videoCallContainer').style.display = 'none';
                document.getElementById('landingPage').style.display = 'flex';

                // Clear inputs
                document.getElementById('userName').value = '';
                document.getElementById('roomId').value = '';
                document.getElementById('shareLinkJoin').value = '';

                // Clear participants and messages
                document.getElementById('participantsList').innerHTML = '';
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message">
                        <div class="message-author">System</div>
                        <div>Welcome to the video call! You can start chatting now.</div>
                        <div class="message-time">Just now</div>
                    </div>
                `;

                // Clear video grid except local video
                const videoGrid = document.getElementById('videoGrid');
                const localVideoWrapper = document.getElementById('localVideoWrapper');
                videoGrid.innerHTML = '';
                if (localVideoWrapper) {
                    videoGrid.appendChild(localVideoWrapper);
                }

                // Add waiting message back
                const waitingMessage = document.createElement('div');
                waitingMessage.className = 'waiting-message';
                waitingMessage.id = 'waitingMessage';
                waitingMessage.innerHTML = `
                    <i class="fas fa-user-plus"></i>
                    <h3 class="text-xl font-semibold mb-2">Waiting for participants</h3>
                    <p class="text-sm">Share your room link to invite others</p>
                `;
                videoGrid.appendChild(waitingMessage);

                showNotification('info', 'Call Ended', 'You have left the call');
            }
        }

        // Handle chat input
        function handleChatInput(event) {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (event.type === 'input') {
                if (message) {
                    // Send typing indicator to others
                    if (socket) {
                        socket.emit('typing', currentRoom, userId, true);
                    }
                    
                    showTypingIndicator();

                    if (typingTimeout) {
                        clearTimeout(typingTimeout);
                    }

                    // Send "stopped typing" after 1 second of inactivity
                    typingTimeout = setTimeout(() => {
                        if (socket) {
                            socket.emit('typing', currentRoom, userId, false);
                        }
                        hideTypingIndicator();
                    }, 1000);
                } else {
                    // Empty message, stop typing indicator
                    if (socket) {
                        socket.emit('typing', currentRoom, userId, false);
                    }
                    hideTypingIndicator();

                    if (typingTimeout) {
                        clearTimeout(typingTimeout);
                        typingTimeout = null;
                    }
                }
            }

            if (event.key === 'Enter' && message) {
                // Send message
                addChatMessage(userName, message, true);

                // Send to other participants via signaling server
                if (socket) {
                    socket.emit('chat-message', currentRoom, message, userName);
                }

                // Stop typing indicator
                if (socket) {
                    socket.emit('typing', currentRoom, userId, false);
                }

                input.value = '';
                hideTypingIndicator();

                // Clear typing timeout
                if (typingTimeout) {
                    clearTimeout(typingTimeout);
                    typingTimeout = null;
                }

                // Prevent form submission if any
                event.preventDefault();
            }
        }

        // Show typing indicator
        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'flex';
            indicator.innerHTML = `
                <span class="text-sm text-gray-400">Someone is typing...</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'none';
        }

        // Add chat message
        function addChatMessage(author, message, isOwn = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOwn ? 'own' : ''}`;

            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            messageDiv.innerHTML = `
                <div class="message-author">${author}</div>
                <div>${message}</div>
                <div class="message-time">${time}</div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show notification
        function showNotification(type, title, message) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            const icon = notification.querySelector('i');

            notificationTitle.textContent = title;
            notificationMessage.textContent = message;

            notification.className = `notification ${type}`;

            switch (type) {
                case 'success':
                    icon.className = 'fas fa-check-circle text-2xl';
                    icon.style.color = '#22FB09';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle text-2xl text-red-400';
                    break;
                case 'info':
                    icon.className = 'fas fa-info-circle text-2xl text-blue-400';
                    break;
            }

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Handle window resize
        window.addEventListener('resize', function () {
            const videoGrid = document.querySelector('.video-grid');
            if (window.innerWidth < 768) {
                videoGrid.style.gridTemplateColumns = '1fr';
            } else {
                videoGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
            }
        });
    </script>
</body>

</html>